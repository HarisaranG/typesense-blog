<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>DynamoDB Integration with Typesense | Typesense Blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Indexing DynamoDB documents in Typesense">
    
    <link rel="preload" href="/assets/css/0.styles.fbb24278.css" as="style"><link rel="preload" href="/assets/js/app.a7a255e1.js" as="script"><link rel="preload" href="/assets/js/2.2d724b92.js" as="script"><link rel="preload" href="/assets/js/3.11b59067.js" as="script"><link rel="prefetch" href="/assets/js/10.834e2db1.js"><link rel="prefetch" href="/assets/js/4.0586f76f.js"><link rel="prefetch" href="/assets/js/5.20add81d.js"><link rel="prefetch" href="/assets/js/6.f1c0e261.js"><link rel="prefetch" href="/assets/js/7.25fb9cac.js"><link rel="prefetch" href="/assets/js/8.4fa67134.js"><link rel="prefetch" href="/assets/js/9.6b52232f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fbb24278.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Typesense Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>DynamoDB Integration with Typesense</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/2021-03-08-dynamodb-typesense-integration.html#create-aws-dynambodb-with-streams-enabled" class="sidebar-link">Create AWS DynamboDB with streams enabled</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/2021-03-08-dynamodb-typesense-integration.html#setting-up-triggers-for-dyanmodb" class="sidebar-link">Setting up Triggers for DyanmoDB</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/2021-03-08-dynamodb-typesense-integration.html#create-lambda-execution-role-only-for-command-line" class="sidebar-link">Create Lambda Execution Role (only for Command Line)</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/2021-03-08-dynamodb-typesense-integration.html#importing-typesense-python-package-in-lambda-function" class="sidebar-link">Importing `typesense` python package in Lambda function</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/2021-03-08-dynamodb-typesense-integration.html#create-a-cloud9-linux-instance-aws" class="sidebar-link">Create a Cloud9 Linux instance AWS</a></li><li class="sidebar-sub-header"><a href="/2021-03-08-dynamodb-typesense-integration.html#create-a-typesense-layer" class="sidebar-link">Create a `typesense` layer</a></li><li class="sidebar-sub-header"><a href="/2021-03-08-dynamodb-typesense-integration.html#adding-typesense-layer-to-lambda" class="sidebar-link">Adding `typesense` layer to Lambda</a></li></ul></li><li><a href="/2021-03-08-dynamodb-typesense-integration.html#typesense-cloud" class="sidebar-link">Typesense Cloud</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/2021-03-08-dynamodb-typesense-integration.html#code-for-lambda-function" class="sidebar-link">Code for Lambda function</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/2021-03-08-dynamodb-typesense-integration.html#deploying-a-lambda-function-only-for-command-line" class="sidebar-link">Deploying a Lambda function (only for Command Line)</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="dynamodb-integration-with-typesense"><a href="#dynamodb-integration-with-typesense" class="header-anchor">#</a> DynamoDB Integration with Typesense</h1> <p>Hey there! This post give you a guide to integrate Typesense server with AWS DynamoDB by setting up a trigger with AWS Lambda.</p> <p><img src="/assets/img/dynamodb-typesense-integration-1.005fffeb.png" alt="Typesense DynamoDB Integration Chart"></p> <h2 id="create-aws-dynambodb-with-streams-enabled"><a href="#create-aws-dynambodb-with-streams-enabled" class="header-anchor">#</a> Create AWS DynamboDB with streams enabled</h2> <p>Create a DynamoDB with your choice of name and partition key (&quot;id&quot; is recommended). Now, after creating a DynamoDB database you should enable streams in the &quot;Overview&quot; section.</p> <p><img src="/assets/img/dynamodb-typesense-integration-2.8bda7cdb.png" alt="DynamoDB streams"></p> <p>If you are doing this in AWS CLI,</p> <div class="language-bash extra-class"><pre class="language-bash"><code>aws dynamodb create-table <span class="token punctuation">\</span>
    --table-name typensense <span class="token punctuation">\</span>
    --attribute-definitions <span class="token assign-left variable">AttributeName</span><span class="token operator">=</span>id,AttributeType<span class="token operator">=</span>N <span class="token punctuation">\</span>
    --key-schema <span class="token assign-left variable">AttributeName</span><span class="token operator">=</span>id,KeyType<span class="token operator">=</span>HASH  <span class="token punctuation">\</span>
    --provisioned-throughput <span class="token assign-left variable">ReadCapacityUnits</span><span class="token operator">=</span><span class="token number">5</span>,WriteCapacityUnits<span class="token operator">=</span><span class="token number">5</span> <span class="token punctuation">\</span>
    --stream-specification <span class="token assign-left variable">StreamEnabled</span><span class="token operator">=</span>true,StreamViewType<span class="token operator">=</span>NEW_AND_OLD_IMAGES
</code></pre></div><h2 id="setting-up-triggers-for-dyanmodb"><a href="#setting-up-triggers-for-dyanmodb" class="header-anchor">#</a> Setting up Triggers for DyanmoDB</h2> <p>Create a trigger for DynamoDB database and this will lead you to AWS Lambada function's page from there you can select an existing funciton or a new function. In this tutorial the function name is <code>typesense-indexing</code></p> <p><img src="/assets/img/dynamodb-typesense-integration-3.3d117cc9.png" alt="DynamoDB Triggers"></p> <p>Then now you need to create a &quot;Lambda Execution Role&quot; i.e give permission for your function. Now, head over to IAM Roles section and create a new role with three main permissions:</p> <ul><li>AmazonDynamoDBFullAccess</li> <li>AmazonDynamoDBFullAccesswithDataPipeline</li> <li>AWSLambdaBasicExecutionRole</li></ul> <p><img src="/assets/img/dynamodb-typesense-integration-4.328fdbb5.png" alt="IAM Execution Role"></p> <p>Now, attach this execution role to the trigger Lambda funtion of DynamoDB.</p> <h2 id="create-lambda-execution-role-only-for-command-line"><a href="#create-lambda-execution-role-only-for-command-line" class="header-anchor">#</a> Create Lambda Execution Role (only for Command Line)</h2> <p>Create a file named <code>trust-relationship.json</code> with the following contents.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
   <span class="token property">&quot;Version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2012-10-17&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;Statement&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
     <span class="token punctuation">{</span>
       <span class="token property">&quot;Effect&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Allow&quot;</span><span class="token punctuation">,</span>
       <span class="token property">&quot;Principal&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
         <span class="token property">&quot;Service&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lambda.amazonaws.com&quot;</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
       <span class="token property">&quot;Action&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sts:AssumeRole&quot;</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Then, create execute the following command</p> <div class="language-bash extra-class"><pre class="language-bash"><code>aws iam create-role --role-name TypesenseLambdaRole <span class="token punctuation">\</span>
    --path <span class="token string">&quot;/service-role/&quot;</span> <span class="token punctuation">\</span>
    --assume-role-policy-document file://trust-relationship.json
</code></pre></div><p>Now, create <code>role-policy.json</code> with the following contents. (Replace <code>accountID</code> and <code>region</code>)</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;Version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2012-10-17&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;Statement&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;Effect&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Allow&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;Action&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lambda:InvokeFunction&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;Resource&quot;</span><span class="token operator">:</span> <span class="token string">&quot;arn:aws:lambda:region:accountID:function:typesense-indexing*&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;Effect&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Allow&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;Action&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">&quot;logs:CreateLogGroup&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;logs:CreateLogStream&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;logs:PutLogEvents&quot;</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;Resource&quot;</span><span class="token operator">:</span> <span class="token string">&quot;arn:aws:logs:region:accountID:*&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;Effect&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Allow&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;Action&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">&quot;dynamodb:DescribeStream&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;dynamodb:GetRecords&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;dynamodb:GetShardIterator&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;dynamodb:ListStreams&quot;</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;Resource&quot;</span><span class="token operator">:</span> <span class="token string">&quot;arn:aws:dynamodb:region:accountID:table/typesense/stream/*&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The policy has three statements that allow TypesenseLambdaRole to do the following:</p> <ul><li>Run a Lambda function <code>typesense-indexing</code>. You create the function later in this tutorial.</li> <li>Access Amazon CloudWatch Logs. The Lambda function writes diagnostics to CloudWatch Logs at runtime.</li> <li>Read data from the DynamoDB stream for <code>typesense</code>.</li></ul> <p>Now, we are going to attach the above roles to our IAM execution role which we have created</p> <div class="language-bash extra-class"><pre class="language-bash"><code>aws iam put-role-policy --role-name TypesenseLambdaRole <span class="token punctuation">\</span>
    --policy-name TypesenseLambdaRolePolicy <span class="token punctuation">\</span>
    --policy-document file://role-policy.json
</code></pre></div><h2 id="importing-typesense-python-package-in-lambda-function"><a href="#importing-typesense-python-package-in-lambda-function" class="header-anchor">#</a> Importing <code>typesense</code> python package in Lambda function</h2> <p>We can't use <code>pip install</code> in Lambda functions. So, the workaround way for that is use AWS Cloud9 service and create Lambda function layer and add it to our <code>typesense-indexing</code> function.</p> <h3 id="create-a-cloud9-linux-instance-aws"><a href="#create-a-cloud9-linux-instance-aws" class="header-anchor">#</a> Create a Cloud9 Linux instance AWS</h3> <p>Create a new Environment in Cloud9 with your choice of name and the default choice of settings (<code>t2.micro</code>, <code>Amazon Linux 2</code>). Click 'Create Environment'. Then, you are good to go</p> <p><img src="/assets/img/dynamodb-typesense-integration-5.f63eee7f.png" alt="AWS Cloud9"></p> <h3 id="create-a-typesense-layer"><a href="#create-a-typesense-layer" class="header-anchor">#</a> Create a <code>typesense</code> layer</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mkdir</span> dependencies
<span class="token builtin class-name">cd</span> dependencies
virtualenv v-env
<span class="token builtin class-name">source</span> ./v-env/bin/activate
pip <span class="token function">install</span> typesense
pip <span class="token function">install</span> simplejson
deactivate
</code></pre></div><p>In the above <code>pip install</code> you can add all the dependencies for your project in that environment</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mkdir</span> python
<span class="token builtin class-name">cd</span> python
<span class="token function">cp</span> -r <span class="token punctuation">..</span>/v-env/lib64/python3.7/site-packages/* <span class="token builtin class-name">.</span>
<span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>
<span class="token function">zip</span> -r typesense_layer.zip python
aws lambda publish-layer-version --layer-name typesense <span class="token punctuation">\</span>
--zip-file fileb://typesense_layer.zip --compatible-runtimes python3.7
</code></pre></div><p>Check your <code>python version</code> and add the folder name according to that. For e.g., <code>python3.6</code> it is <code>dist-packages</code> instead of <code>site-packages</code>. Even check and change runtime version of the Lambda function.</p> <h3 id="adding-typesense-layer-to-lambda"><a href="#adding-typesense-layer-to-lambda" class="header-anchor">#</a> Adding <code>typesense</code> layer to Lambda</h3> <p><img src="/assets/img/dynamodb-typesense-integration-6.9d0b6d80.png" alt="AWS Lambda Layer"></p> <p>Now, add the created layer to your <code>typesense-indexing</code> lambda function by choosing <code>'Add layer' -&gt; 'Custom Layer'</code></p> <p><img src="/assets/img/dynamodb-typesense-integration-7.e70f6a39.png" alt="AWS Lambda Layer"></p> <p>That's it now you use <code>import typesense</code> use typesense libraries in your AWS Lambda function.</p> <h2 id="typesense-cloud"><a href="#typesense-cloud" class="header-anchor">#</a> Typesense Cloud</h2> <p>Sign-Up for a Typesense Cloud account and then create a new cluster</p> <p><img src="/assets/img/dynamodb-typesense-integration-8.9487124f.png" alt="Typesense Cloud"></p> <p>After creating a cloud typesense account, you will get an 'Endpoint URL' and get a API key using 'Generate an API Key' option</p> <p><img src="/assets/img/dynamodb-typesense-integration-9.24d5636a.png" alt="Typesense Cloud"></p> <p>Using this only we will call our typesense server and index the dynamodb documents</p> <h2 id="code-for-lambda-function"><a href="#code-for-lambda-function" class="header-anchor">#</a> Code for Lambda function</h2> <p>Now, import the following packages which we have imported as a layer in Lambda.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> typesense
<span class="token keyword">import</span> simplejson <span class="token keyword">as</span> json
</code></pre></div><p>Initialize a Typesense client. For the above e.g,</p> <div class="language-python extra-class"><pre class="language-python"><code>client <span class="token operator">=</span> typesense<span class="token punctuation">.</span>Client<span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">'nodes'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        <span class="token string">'host'</span><span class="token punctuation">:</span> <span class="token string">'i3jcr4k0wfbz6qnup-1.a1.typesense.net'</span><span class="token punctuation">,</span>
        <span class="token string">'port'</span><span class="token punctuation">:</span> <span class="token string">'443'</span><span class="token punctuation">,</span>
        <span class="token string">'protocol'</span><span class="token punctuation">:</span> <span class="token string">'https'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'api_key'</span><span class="token punctuation">:</span> <span class="token string">'AaBOdPwIj7doBybWN5rfiXd12baeudWD'</span><span class="token punctuation">,</span>
    <span class="token string">'connection_timeout_seconds'</span><span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Now, we need to create a collection. For creating a collection, check out the API Docs of typesense</p> <p><a href="https://new-site.typesense.org/docs/0.19.0/api/collections.html#create-a-collection" target="_blank" rel="noopener noreferrer">Typesense API Docs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>When a data is added in DynamoDB, the Lambda function is called with <code>event</code> and <code>context</code> parameters. A sample event parameter form DynamoDB would be,</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;Records&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;eventID&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;eventVersion&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;dynamodb&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;OldImage&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token comment">// Existing values</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;SequenceNumber&quot;</span><span class="token operator">:</span> <span class="token string">&quot;222&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;Keys&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token comment">// your partion key and sort key</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;SizeBytes&quot;</span><span class="token operator">:</span> <span class="token number">59</span><span class="token punctuation">,</span>
            <span class="token property">&quot;NewImage&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token comment">// New Values</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;awsRegion&quot;</span><span class="token operator">:</span> <span class="token string">&quot;us-east-2&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;eventName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MODIFY&quot;</span><span class="token punctuation">,</span> <span class="token comment">// this can 'INSERT', 'MODIFY' and 'DELETE'</span>
            <span class="token property">&quot;eventSourceARN&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&lt;AWS-ARN&gt;&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;eventSource&quot;</span><span class="token operator">:</span> <span class="token string">&quot;aws:dynamodb&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>A sample to code to to process above <code>event</code> response</p> <div class="language-python extra-class"><pre class="language-python"><code>processed <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> record <span class="token keyword">in</span> event<span class="token punctuation">[</span><span class="token string">'Records'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    ddb_record <span class="token operator">=</span> record<span class="token punctuation">[</span><span class="token string">'dynamodb'</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> record<span class="token punctuation">[</span><span class="token string">'eventName'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'REMOVE'</span><span class="token punctuation">:</span>
        res <span class="token operator">=</span> client<span class="token punctuation">.</span>collections<span class="token punctuation">[</span><span class="token string">'&lt;collection-name&gt;'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>documents<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>ddb_record<span class="token punctuation">[</span><span class="token string">'OldImage'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'N'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        upload <span class="token operator">=</span> ddb_record<span class="token punctuation">[</span><span class="token string">'NewImage'</span><span class="token punctuation">]</span> <span class="token comment"># format your document here and the use upsert function to index it.</span>
        res <span class="token operator">=</span> client<span class="token punctuation">.</span>collections<span class="token punctuation">[</span><span class="token string">'IPL-Data'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>upsert<span class="token punctuation">(</span>upload<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    processed <span class="token operator">=</span> processed <span class="token operator">+</span> <span class="token number">1</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Successfully processed {} records'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>processed<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="deploying-a-lambda-function-only-for-command-line"><a href="#deploying-a-lambda-function-only-for-command-line" class="header-anchor">#</a> Deploying a Lambda function (only for Command Line)</h2> <ul><li>Create a file named <code>typesense.py</code> and add your code into it.</li> <li>Create a zip file to contain <code>typesense.py</code>. If you have zip command-line utility<div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">zip</span> typesense-indexing.zip typesense.py
</code></pre></div></li> <li>Get the ARN for the the execution role you created<div class="language-bash extra-class"><pre class="language-bash"><code>aws iam get-role --role-name TypesenseLambdaRole
</code></pre></div>In output, look for ARN,<div class="language-json extra-class"><pre class="language-json"><code>...
<span class="token property">&quot;Arn&quot;</span><span class="token operator">:</span> <span class="token string">&quot;arn:aws:iam::region:role/service-role/WooferLambdaRole&quot;</span>
...
</code></pre></div></li> <li>Now, create the Lambda function<div class="language-bash extra-class"><pre class="language-bash"><code>aws lambda create-function <span class="token punctuation">\</span>
  --region us-east-2 <span class="token punctuation">\</span>
  --function-name typesense-indexing <span class="token punctuation">\</span>
  --zip-file fileb://typesense-indexing.zip <span class="token punctuation">\</span>
  --role <span class="token variable"><span class="token variable">`</span>roleARN<span class="token variable">`</span></span> <span class="token punctuation">\</span>
  --handler typesense-indexing.handler <span class="token punctuation">\</span>
  --timeout <span class="token number">5</span> <span class="token punctuation">\</span>
  --runtime python3.7
</code></pre></div></li> <li>We need to ARN for DynamoDB to enable trigger for the database<div class="language-bash extra-class"><pre class="language-bash"><code>aws dynamodb describe-table --table-name <span class="token variable"><span class="token variable">`</span>table-name<span class="token variable">`</span></span>
</code></pre></div>Note, the ARN for the stream<div class="language-json extra-class"><pre class="language-json"><code>...
  <span class="token property">&quot;LatestStreamArn&quot;</span><span class="token operator">:</span> <span class="token string">&quot;arn:aws:dynamodb:`region`:`accountID`:table/`table-name`/stream/`timestamp`&quot;</span>
...
</code></pre></div></li> <li>Now, add this ARN to Lambda<div class="language-bash extra-class"><pre class="language-bash"><code>aws lambda create-event-source-mapping <span class="token punctuation">\</span>
  --region us-east-1 <span class="token punctuation">\</span>
  --function-name typesense-indexing <span class="token punctuation">\</span>
  --event-source <span class="token variable"><span class="token variable">`</span>streamARN <span class="token variable">`</span></span> <span class="token punctuation">\</span>
  --batch-size <span class="token number">1</span> <span class="token punctuation">\</span>
  --starting-position TRIM_HORIZON
</code></pre></div></li> <li>Make sure to test the function with a set of sample events before enabling the trigger.</li></ul> <p>That's a wrap! Now your DynamoDB database will be automatically indexed in your Typesense cluster.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a7a255e1.js" defer></script><script src="/assets/js/2.2d724b92.js" defer></script><script src="/assets/js/3.11b59067.js" defer></script>
  </body>
</html>
